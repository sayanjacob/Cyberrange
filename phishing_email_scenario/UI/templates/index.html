<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cyber Range Control Panel</title>
    <!-- Bootstrap CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container py-4">
        <h1 class="mb-4 text-primary">Cyber Range Demo</h1>

        <div class="mb-3">
            <button class="btn btn-success me-2" onclick="fetch('/start')">Start Environment</button>
            <button class="btn btn-danger me-2" onclick="fetch('/stop')">Stop Environment</button>
            <button class="btn btn-info" onclick="window.location.href='/guide'">View Guide</button>
        </div>

        <div class="row">
            <div class="col-md-4 mb-4">
                <h2 class="h5">Live Logs</h2>
                <pre id="logs" class="bg-white border rounded p-2" style="height: 300px; overflow-y: scroll;"></pre>
            </div>
            <div class="col-md-4 mb-4">
                <h2 class="h5">Live Vagrant Logs</h2>
                <pre id="log-output" class="bg-white border rounded p-2" style="height: 300px; overflow-y: scroll;"></pre>
            </div>
            <div class="col-md-4 mb-4">
                <h2 class="h5">Linux Terminal Output</h2>
                <pre id="terminal-output" class="bg-dark text-success border rounded p-2" style="height: 300px; overflow-y: scroll; font-family: 'Fira Mono', 'Consolas', monospace;"></pre>
            </div>
        </div>
    </div>

    <script>
        const logBox = document.getElementById("logs");
        const logOutput = document.getElementById('log-output');
        const terminalOutput = document.getElementById('terminal-output');

        // Connect to log stream
        const eventSource = new EventSource("/logs");
        eventSource.onmessage = function(event) {
            logBox.textContent += event.data + "\n";
            logBox.scrollTop = logBox.scrollHeight;
            logOutput.textContent += event.data + "\n";
            logOutput.scrollTop = logOutput.scrollHeight;
            // Show all logs in terminal output
            terminalOutput.textContent += event.data + "\n";
            terminalOutput.scrollTop = terminalOutput.scrollHeight;
        };
        eventSource.onerror = function(event) {
            logBox.textContent += "[Error: Log stream disconnected]\n";
            eventSource.close();
        };
    </script>
</body>
</html>
